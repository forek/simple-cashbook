### 设计思路
在本文中，我会简单描述我在解决本题目时的思考过程，包括对题目的理解和思考、技术选型抉择策略、实现细节思考等等。

---

#### 准备阶段
当我拿到题目并仔细审题之后，我决定使用纯前端实现的方式:

* 使用`TypoScript` + `React` + `React Hooks`开发
* 用`create-react-app`工具创建项目
* 数据持久化提供两种方案:
* * 少量数据直接储存到`localStorage`
* * 当数据太大超出`localStorage`储存上限时, 提供`保存为文件`功能储存
* UI框架使用纯CSS版本的`bootstrap`
* * 由于没有引入`bootstrap`配套的JS工具, 故下拉菜单等组件需要自行实现

---

#### 开发阶段
经过准备阶段之后，这个项目的方向已经大致定了下来。接下来我将根据各个功能点，分别讲述开发过程中遇到的问题和我的解决方案。

##### 加载题目所提供的数据
这里我选择使用“用户自行导入表单”的方式实现，当启动空项目后，表格内部没有任何数据。此时需要用户自行通过操作栏的导入按钮，导入账单表和类型表。我认为用户导入的方式比表格内预设数据的方式更合理，而且有需要的话，用户可以继续导入更多其他表格，把数据添加到应用中。

##### 实现功能
* 以列表的形式展示账单内容，并且提供下拉框选择月份进行筛选
* 表格支持分页功能（额外功能）
* 支持使用者添加账单
* 支持使用者删除账单（额外功能）
* 简单地统计并展示所选月份的收入和支出总金额
* 对账单分类进行二次筛选
* 对选择月份内的所有账单根据账单分类进行支出金额统计，并进行排序

在初期设计这些功能的时候，我认为使用`useReducer`这个hook将数据（model）与页面（view）分离更适合，这样有利于页面和数据解耦，使得数据处理逻辑开发更顺畅，也更方便编写单元测试。

但是在开发中期，我发现这些功能整合在一起的时候逻辑变得非常复杂，用户每一个操作都可能对应一到多个数据逻辑运行，比如：当用户点筛选月份时，系统必须重新计算`筛选 -> 分页 -> 生成统计数据`这一整个流程；而当用户仅仅点击分页器按钮时，由于分页不影响筛选和统计，所以其实只需要重新执行`分页`功能即可。

经过一段时间的思考，我决定在reducer内部实现一个`处理管线（pipeline）`模块来处理数据逻辑流程：这个管线模块的核心思想是把不同的数据处理逻辑抽象成一个个独立的逻辑单元，这些逻辑单元会产生对redux state状态的更改，以及产生/保存每个单元运行得到的临时结果。我们只需要把这些逻辑单元按照顺序组合到一起运行就可以完成一系列数据处理任务。

逻辑单元抽象：
* 生成筛选选项：根据账单数据生成筛选器可以提供哪些选项，比如：月份 - `2019-07`、`2019-09` 等
* 执行筛选：根据用户设定的筛选条件执行筛选，得到分步筛选结果
* 执行分页：根据用户选择的页码执行分页
* 统计数据：根据筛选结果中的`月份结果`，统计当月收支数据

在本项目中我将逻辑单元抽象成上述四个，然后我就可以根据不同的用户操作来设计对应的预设管线了：
* 导入/添加/删除账单：生成筛选选项 -> 执行筛选 -> 执行分页 -> 统计数据
* 筛选: 执行筛选 -> 执行分页 -> 统计数据
* 分页: （获取筛选结果缓存） -> 执行分页

这样设计的好处是，我可以给不同的用户操作设计对应不同的预设管线，比如分页不需要重新执行筛选，那么我只需要获取上一次的筛选结果缓存，直接用来执行分页。另外，由于每个逻辑单元都是相互独立的，这个模块设计也非常容易扩展，比如现在需要增加一个`排序`功能，我只需要添加一个`执行排序`逻辑单元，然后把它对应插入到各个预设管线之中：

添加了排序功能的预设管线:
* 筛选：执行筛选 -> 执行排序 -> 执行分页 -> 统计数据
* 分页: （获取排序结果缓存） -> 执行分页

`处理管线（pipeline）`模块还有利于提高执行效率，因为不同的操作可能会使用缓存作为基础执行处理，也不需要重复执行无意义的计算，使得计算效率大大提高。

除此以外，我还在管线模块基础上添加了基础代码性能优化。目前本项目可以轻松处理`一百万条数据`。

* Tips： 使用页面中的`性能测试`功能，可以添加大量随机账单供性能测试

#### 测试
我为核心模块编写了单元测试，可以输入命令运行
```
yarn test
```